version: '3.8'

# Docker Compose for Development Environment
# This configuration includes hot-reload and development tools

services:
  supplier-predictor-dev:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: supplier-predictor-dev
    ports:
      - "8001:8001"
      - "5678:5678"  # Debug port
    environment:
      # Azure OpenAI Configuration
      - AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
      - AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT}
      - AZURE_OPENAI_API_VERSION=${AZURE_OPENAI_API_VERSION:-2024-12-01-preview}
      - AZURE_OPENAI_DEPLOYMENT_NAME=${AZURE_OPENAI_DEPLOYMENT_NAME}
      
      # LangSmith Configuration
      - LANGSMITH_API_KEY=${LANGSMITH_API_KEY}
      - LANGSMITH_PROJECT=${LANGSMITH_PROJECT:-supplier-predictor-dev}
      - LANGSMITH_TRACING=${LANGSMITH_TRACING:-true}
      - LANGCHAIN_TRACING_V2=${LANGCHAIN_TRACING_V2:-true}
      
      # Development Configuration
      - DEBUG=true
      - LOG_LEVEL=DEBUG
      - DATABASE_URL=sqlite:///./supplier_predictor_dev.db
      - SECRET_KEY=dev-secret-key-not-for-production
      - API_TOKEN=dev-token
    volumes:
      # Mount source code for hot reload
      - .:/app
      - /app/.venv  # Exclude virtual environment
      - dev_data:/app/data
    restart: unless-stopped
    command: >
      sh -c "python -m uvicorn backend.main:app 
             --host 0.0.0.0 
             --port 8001 
             --reload 
             --log-level debug"
    networks:
      - dev-network
    labels:
      - "com.supplier-predictor.env=development"

  # Database admin tool for development
  adminer:
    image: adminer
    container_name: supplier-predictor-adminer
    ports:
      - "8080:8080"
    networks:
      - dev-network
    profiles:
      - admin

volumes:
  dev_data:
    driver: local

networks:
  dev-network:
    driver: bridge
